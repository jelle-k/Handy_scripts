DECLARE @tot AS INTEGER;DECLARE @cos AS VARCHAR(10);SET @tot = (SELECT SUM(Quantity) FROM DLN1 WHERE DocEntry = 67291 AND ItemCode <> '99999997');SET @cos = (SELECT MAX(NUM) FROM ( SELECT CASE WHEN ItemCode = '99999997' THEN cast(SUM(LineTotal) as varchar(10)) END AS NUM FROM DLN1 WHERE DocEntry = 67291 GROUP BY ItemCode) src);SELECT @cos * (T1.Quantity/@tot) AS A1, @tot AS A2 FROM ODLN T0 INNER JOIN DLN1 T1 ON T0.[DocEntry] = T1.[DocEntry] WHERE T1.ItemCode <> '99999997' AND T0.[DocEntry] = 67291